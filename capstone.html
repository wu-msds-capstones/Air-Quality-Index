<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.53">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Stéphane Berhault">
<meta name="author" content="Jake Warmflash">
<meta name="dcterms.date" content="2024-08-01">
<meta name="keywords" content="AQI, Time Series, Prophet, SARIMAX, Scikit-Learn">

<title>Unveiling the Drivers of Clean Air</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="floating">

<div id="quarto-search-results"></div>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Unveiling the Drivers of Clean Air</h1>
            <p class="subtitle lead">Analysis of Portland Air Quality (AQI)</p>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Stéphane Berhault <a href="mailto:sgberhault@willamette.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> <a href="https://orcid.org/0009-0003-5357-629X" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              <a href="https://willamette.edu">
              Willamette University
              </a>
            </p>
        </div>
      <div class="quarto-title-meta-contents">
      <p class="author">Jake Warmflash <a href="mailto:jwarmflash@willamette.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              <a href="https://willamette.edu">
              Willamette University
              </a>
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 1, 2024</p>
      </div>
    </div>
    
      
    </div>
    

  <div>
    <div class="keywords">
      <div class="block-title">Keywords</div>
      <p>AQI, Time Series, Prophet, SARIMAX, Scikit-Learn</p>
    </div>
  </div>
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a>
  <ul class="collapse">
  <li><a href="#data-ethics" id="toc-data-ethics" class="nav-link" data-scroll-target="#data-ethics">Data Ethics</a></li>
  </ul></li>
  <li><a href="#methods" id="toc-methods" class="nav-link" data-scroll-target="#methods">Methods</a>
  <ul class="collapse">
  <li><a href="#prophet" id="toc-prophet" class="nav-link" data-scroll-target="#prophet">Prophet</a></li>
  <li><a href="#sarimax" id="toc-sarimax" class="nav-link" data-scroll-target="#sarimax">SARIMAX​​</a></li>
  <li><a href="#akaike-information-criteria-aic" id="toc-akaike-information-criteria-aic" class="nav-link" data-scroll-target="#akaike-information-criteria-aic">Akaike Information Criteria (AIC)</a>
  <ul class="collapse">
  <li><a href="#interpretation" id="toc-interpretation" class="nav-link" data-scroll-target="#interpretation">Interpretation</a></li>
  <li><a href="#usage" id="toc-usage" class="nav-link" data-scroll-target="#usage">Usage</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  </ul></li>
  <li><a href="#train-test-split" id="toc-train-test-split" class="nav-link" data-scroll-target="#train-test-split">Train-Test-Split</a></li>
  <li><a href="#hypothesis-testing" id="toc-hypothesis-testing" class="nav-link" data-scroll-target="#hypothesis-testing">Hypothesis Testing</a></li>
  <li><a href="#machine-learning" id="toc-machine-learning" class="nav-link" data-scroll-target="#machine-learning">Machine Learning</a></li>
  </ul></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a>
  <ul class="collapse">
  <li><a href="#air-quality-data" id="toc-air-quality-data" class="nav-link" data-scroll-target="#air-quality-data">Air Quality Data</a></li>
  <li><a href="#meteorological-data" id="toc-meteorological-data" class="nav-link" data-scroll-target="#meteorological-data">Meteorological Data</a></li>
  <li><a href="#pollution-source-data" id="toc-pollution-source-data" class="nav-link" data-scroll-target="#pollution-source-data">Pollution Source Data</a></li>
  <li><a href="#public-transit-data" id="toc-public-transit-data" class="nav-link" data-scroll-target="#public-transit-data">Public Transit Data</a></li>
  <li><a href="#land-area-data" id="toc-land-area-data" class="nav-link" data-scroll-target="#land-area-data">Land Area Data</a></li>
  <li><a href="#park-area-data" id="toc-park-area-data" class="nav-link" data-scroll-target="#park-area-data">Park Area Data</a></li>
  <li><a href="#livestock-data" id="toc-livestock-data" class="nav-link" data-scroll-target="#livestock-data">Livestock Data</a></li>
  <li><a href="#population-data" id="toc-population-data" class="nav-link" data-scroll-target="#population-data">Population Data</a></li>
  <li><a href="#data-organization" id="toc-data-organization" class="nav-link" data-scroll-target="#data-organization">Data Organization</a></li>
  </ul></li>
  <li><a href="#prophet-aqi-trend-forecasting-and-statistical-testing" id="toc-prophet-aqi-trend-forecasting-and-statistical-testing" class="nav-link" data-scroll-target="#prophet-aqi-trend-forecasting-and-statistical-testing">Prophet AQI Trend Forecasting and Statistical Testing</a>
  <ul class="collapse">
  <li><a href="#data-forecasting-with-prophet" id="toc-data-forecasting-with-prophet" class="nav-link" data-scroll-target="#data-forecasting-with-prophet">Data Forecasting with Prophet</a></li>
  <li><a href="#wildfires" id="toc-wildfires" class="nav-link" data-scroll-target="#wildfires">2020 Wildfires</a></li>
  <li><a href="#aqi-trends" id="toc-aqi-trends" class="nav-link" data-scroll-target="#aqi-trends">AQI Trends</a></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation">Cross Validation</a></li>
  <li><a href="#portlands-transit-system" id="toc-portlands-transit-system" class="nav-link" data-scroll-target="#portlands-transit-system">Portland’s Transit System</a></li>
  </ul></li>
  <li><a href="#machine-learning-with-scikit-learn" id="toc-machine-learning-with-scikit-learn" class="nav-link" data-scroll-target="#machine-learning-with-scikit-learn">Machine Learning with Scikit-Learn</a></li>
  <li><a href="#machine-learning-sarimax" id="toc-machine-learning-sarimax" class="nav-link" data-scroll-target="#machine-learning-sarimax">Machine Learning SARIMAX</a>
  <ul class="collapse">
  <li><a href="#statsmodel" id="toc-statsmodel" class="nav-link" data-scroll-target="#statsmodel">Statsmodel</a></li>
  <li><a href="#components-of-a-time-series" id="toc-components-of-a-time-series" class="nav-link" data-scroll-target="#components-of-a-time-series">Components Of A Time Series</a></li>
  <li><a href="#finding-the-best-forecasting-model-with-grid-search" id="toc-finding-the-best-forecasting-model-with-grid-search" class="nav-link" data-scroll-target="#finding-the-best-forecasting-model-with-grid-search">Finding the Best Forecasting Model with Grid Search</a>
  <ul class="collapse">
  <li><a href="#step-1-setting-up-our-hyperparameters" id="toc-step-1-setting-up-our-hyperparameters" class="nav-link" data-scroll-target="#step-1-setting-up-our-hyperparameters">Step 1: Setting Up Our Hyperparameters</a></li>
  <li><a href="#step-2-trying-out-different-combinations" id="toc-step-2-trying-out-different-combinations" class="nav-link" data-scroll-target="#step-2-trying-out-different-combinations">Step 2: Trying Out Different Combinations</a></li>
  <li><a href="#step-3-checking-the-results" id="toc-step-3-checking-the-results" class="nav-link" data-scroll-target="#step-3-checking-the-results">Step 3: Checking the Results</a></li>
  </ul></li>
  <li><a href="#sarimax-model-results" id="toc-sarimax-model-results" class="nav-link" data-scroll-target="#sarimax-model-results">SARIMAX Model Results</a>
  <ul class="collapse">
  <li><a href="#interpretation-1" id="toc-interpretation-1" class="nav-link" data-scroll-target="#interpretation-1">Interpretation</a></li>
  <li><a href="#autoregressive-term-ar.l1" id="toc-autoregressive-term-ar.l1" class="nav-link" data-scroll-target="#autoregressive-term-ar.l1">Autoregressive Term (ar.L1)</a></li>
  <li><a href="#moving-average-term-ma.l1" id="toc-moving-average-term-ma.l1" class="nav-link" data-scroll-target="#moving-average-term-ma.l1">Moving Average Term (ma.L1)</a></li>
  <li><a href="#seasonal-moving-average-term-ma.s.l12" id="toc-seasonal-moving-average-term-ma.s.l12" class="nav-link" data-scroll-target="#seasonal-moving-average-term-ma.s.l12">Seasonal Moving Average Term (ma.S.L12)</a></li>
  <li><a href="#variance-of-the-residuals-sigma2" id="toc-variance-of-the-residuals-sigma2" class="nav-link" data-scroll-target="#variance-of-the-residuals-sigma2">Variance of the Residuals (sigma2)</a></li>
  </ul></li>
  <li><a href="#fit-sarimax-model" id="toc-fit-sarimax-model" class="nav-link" data-scroll-target="#fit-sarimax-model">Fit SARIMAX model</a></li>
  <li><a href="#forecasting-future-values" id="toc-forecasting-future-values" class="nav-link" data-scroll-target="#forecasting-future-values">Forecasting Future Values</a></li>
  <li><a href="#visualizing-our-results" id="toc-visualizing-our-results" class="nav-link" data-scroll-target="#visualizing-our-results">Visualizing Our Results</a>
  <ul class="collapse">
  <li><a href="#interpreting-the-forecast-plot" id="toc-interpreting-the-forecast-plot" class="nav-link" data-scroll-target="#interpreting-the-forecast-plot">Interpreting the Forecast Plot</a></li>
  <li><a href="#overall-conclusion" id="toc-overall-conclusion" class="nav-link" data-scroll-target="#overall-conclusion">Overall Conclusion</a></li>
  <li><a href="#possible-reasons-for-poor-performance" id="toc-possible-reasons-for-poor-performance" class="nav-link" data-scroll-target="#possible-reasons-for-poor-performance">Possible Reasons for Poor Performance</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix">Appendix</a>
  <ul class="collapse">
  <li><a href="#bibliography" id="toc-bibliography" class="nav-link" data-scroll-target="#bibliography">Bibliography</a></li>
  <li><a href="#additional-resources---eda" id="toc-additional-resources---eda" class="nav-link" data-scroll-target="#additional-resources---eda">Additional Resources - EDA</a>
  <ul class="collapse">
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">Exploratory Data Analysis</a></li>
  <li><a href="#features-engineering" id="toc-features-engineering" class="nav-link" data-scroll-target="#features-engineering">Features Engineering</a></li>
  <li><a href="#sweetviz-data-report" id="toc-sweetviz-data-report" class="nav-link" data-scroll-target="#sweetviz-data-report">Sweetviz Data Report</a></li>
  <li><a href="#advanced-data-analysis" id="toc-advanced-data-analysis" class="nav-link" data-scroll-target="#advanced-data-analysis">Advanced Data Analysis</a></li>
  <li><a href="#time-series-visualization-in-portland" id="toc-time-series-visualization-in-portland" class="nav-link" data-scroll-target="#time-series-visualization-in-portland">Time Series Visualization in Portland</a></li>
  </ul></li>
  <li><a href="#additional-resources---machine-learning-metrics-table" id="toc-additional-resources---machine-learning-metrics-table" class="nav-link" data-scroll-target="#additional-resources---machine-learning-metrics-table">Additional Resources - Machine Learning Metrics Table</a></li>
  </ul></li>
  </ul>
<div class="quarto-other-links"><h2>Other Links</h2><ul><li><a href="https://www.airnow.gov"><i class="bi bi-link-45deg"></i>Airnow Open Data</a></li></ul></div><div class="quarto-code-links"><h2>Code Links</h2><ul><li><a href="SWEETVIZ_REPORT.html"><i class="bi bi-file-code"></i>Sweetviz Analysis Report</a></li></ul></div></nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In their journal article published in <em>The American Journal of Public Health</em>, Jacobs, Burgess, and Abbott tell the story of the Donora Pennsylvania Smog crisis. On October 30, 1948, the Donora High School Football team played through a dense smog to complete the game with hundreds of fans in the audience, despite very poor visibility. The team, fueled by resilience, took pride in playing through poor conditions, a testament to the high spirit of the small town. Soon after, calls to the town’s medical offices began flooding in, complaining of difficulty breathing and respiratory issues. Donora, Pennsylvania, was a town of metalworks, built by the American Steel and Wire company and the Donora Zinc Works company, which made up major parts of the town’s economy. The heavy smog and pollution clouds that covered the sky had been viewed as a sign of prosperity, owing to the industrial might that powered their economy. Within just twelve hours, seventeen people would be dead, 1440 seriously affected, and 4470 with mild to moderate conditions—almost half the town’s working population (Jacobs, Burgess, Abbott).</p>
<p>This event, known as the Donora Smog of 1948, prompted the country into taking a closer look at the negative impacts of air pollution. Widespread debate surrounding the event led to the first legislation aimed at regulating the air quality within the United States, ushering in a new era of tracking, combatting, and reversing the ill effects of poor air quality. The quality of air we breathe has direct impacts on our health. We must understand the factors that contribute to poor air quality and how we individually and collectively contribute to these changes. Until we can visualize the impact we have on our atmosphere, we will continue behavior that negatively impacts the air around us.</p>
<p>In this project, we will focus on the key factors influencing air quality in Portland, Oregon. We aim to understand the complex interplay between various environmental and human-made factors that contribute to high air pollution levels. Initially, we were surprised to discover that Portland, the city we reside in, has some of the best air quality for a city of its size in the United States. This led us to narrow our focus to understanding the factors that contribute to these favorable outcomes in this city.</p>
<p>Our project aims to develop and validate machine learning models to analyze the various factors influencing air quality. By focusing on Portland in comparison to other large US cities, we hope to find things Portland does that lead to the greater AQI outcomes. Our approach will consider a range of variables, including meteorological conditions, pollution sources, transit systems, park land, and livestock. Through this analysis, we aim to provide actionable insights and recommendations for sustaining and improving air quality. By examining both the contributors to clean air and the sources of pollution, we can understand the factors affecting air quality and develop comprehensive strategies for enhancement.</p>
</section>
<section id="background" class="level1">
<h1>Background</h1>
<p>Federal regulation of air quality in the United States began in 1955 with the Air Pollution Control Act. This new piece of legislation provided funding for initial research into air quality and pollution in the US. Building off this and privately funded research, Congress passed the Clean Air Act of 1963, establishing the first federal regulation for controlling air pollution. This act established a new federal program within the US Public Health Service, dedicated to the monitoring and control of air quality. In 1967, Congress passed the Air Quality Act, which introduced more federal oversight and enforcement policies, allowing extensive monitoring of interstate air pollution. This all led to the passage of the 1970 Clean Air Act, aimed at restricting and regulating emissions, measuring and reducing pollutant particles, and addressing upcoming pollution threats (Environmental Protection Agency).</p>
<p>Also established in 1970, the Environmental Protection Agency (EPA) implemented and monitored the requirements established by these rulings. The EPA’s authority extended beyond federal lands and roads to include all companies operating within the United States. Enforcement authority was expanded to allow upholding these established standards, and prevent companies from circumventing the law. Much of the improvement in the quality of air in the US over the past fifty years can be attributed to these regulations. In 1990, when deaths due to air quality were first measured, an estimated 135,000 Americans died. By 2010, that number had dropped to 71,000 (Zhang et al.). Despite the significant improvements led by the federal guidelines of the late 70s, nearly four in ten Americans still live in places where they are exposed to unhealthy air (American Lung Association).</p>
<p>In 1999, the EPA developed the Air Quality Index (AQI), creating an easily understood measurement of air quality. The AQI measures air pollution levels on a scale from 0 to 500, divided into six categories. A score of 0 to 50 represents good air quality which poses little or no risk to those breathing it in, while a score above 300 signifies emergency conditions, an extremely high risk which impacts everyone. This measurement is mainly derived from five major pollutants: ozone (O3), particulate matter (2.5μm and 10μm), carbon monoxide (CO), nitrogen dioxide (NO2), and sulfur dioxide (SO2) (Airnow.gov). Poor air quality has been linked to a variety of diseases including respiratory infections, stroke, heart disease, lung cancer, and chronic obstructive pulmonary disease, among others (World Health Organization). An estimated seven million premature deaths annually can be attributed to air pollution, which equates to a global mean loss of life expectancy of 2.9 years, making it the largest environmental risk factor for disease and premature death (Fuller, Landrigan, Balakrishnan, et al.). Thus, it is important to understand factors that contribute to poor air quality, and outcomes that can be attributed to the state of the AQI.</p>
<p>These harmful factors can originate from a variety of sources. Anything that releases a foreign substance into the air can lower the AQI. This includes smoking, vehicle exhaust, combustion processes for production and manufacturing, household cleaning products, appliances, central air and heating systems, agriculture pesticides, livestock, shipping and transportation, and much more. Individually, we can reduce our individual contributions by lowering our reliance on personal vehicles, watching our power usage, supporting companies that monitor and address their emissions, and more. However, there are many factors beyond our control. Larger pollutant sources, such as manufacturing and transportation, are often regulated to some extent but may still release significant amounts of pollutants into the atmosphere which we as individuals have no say over (Manisalidis, Stavropoulou, Stavropoulos, Bezirtzoglou). It is challenging to restrict and watch our personal contributions to the polluting of the environment without worrying about what others are doing. Measuring and analyzing the impact these pollutants have on air quality is a crucial step towards addressing these issues.</p>
<section id="data-ethics" class="level2">
<h2 class="anchored" data-anchor-id="data-ethics">Data Ethics</h2>
<p>The ethical implications of conducting this analysis should always be considered and addressed. Air quality has historically impacted lower income communities significantly more. Marginalized communities may be built near major pollution sources such as factories or highways. In Portland, for example, Interstate 5 completed construction in 1966. It was part of an Oregon State Highway Department (OSHD) development, a project run by the state as a part of the Federal Aid Highway Act. The highway was built on the existing Minnesota Avenue, cutting North Portland, the heart of Portland’s African American community in half. It was decided to avoid affecting the higher income downtown properties. In fact, the OSHD contracted work on the Minnesota Ave portion of the highway to private contractors, in an effort to avoid a political battle (Oregon Encyclopedia). Today, the neighborhoods surrounding the large highway have worse AQI outcomes than those further away, all other factors equal (Shandas and George). Any recommendations given by this analysis should properly consider the ramifications of those impacted.</p>
<p>Another important ethical issue to be aware of is data transparency. Data can be used to push a specific narrative without faking or editing the specific data points. By leaving out important information, pushing correlated data as causation to push an agenda, or by purposely misconstruing what the data means, one can create a narrative that can misinform or deceive readers. All analysis methodology must be openly discussed to ensure full understanding by audiences. This leads to credibility, reproducibility, and trust in the methods and conclusions of any piece of data analysis. All data is sourced from credible online sources that are open about their collection methods. Data privacy is addressed and no personalized information is given. Limitations are also addressed allowing readers to understand where any uncertainty may be.</p>
</section>
</section>
<section id="methods" class="level1">
<h1>Methods</h1>
<p>Python will be the primary programming language used to conduct this analysis. We will also use R language in statistical applications. To perform our analysis, we will employ the NumPy and Pandas libraries for data manipulation, Matplotlib and Seaborn for visualization, and Time Series forecasting algorithms such as Prophet and SARIMAX. We will address data inconsistencies, missing values and ensure that data is in a tidy format. We may need to normalize or standardize data if necessary and create new features through aggregation to enhance the model’s performance.</p>
<section id="prophet" class="level2">
<h2 class="anchored" data-anchor-id="prophet">Prophet</h2>
<p>Prophet is an open-source forecasting tool developed by Meta, designed for forecasting time series data. It is suited for datasets with strong seasonal, monthly, weekly, or daily patterns, and it handles missing data and outliers well. We utilized prophet to gain a quick understanding of our AQI patterns, seeking to understand basic trends before conducting a more thorough analysis.</p>
<p>Key features of Prophet include seasonality detection and holiday incorporation, while providing easy use and understanding for users. We can use this software to get complex understanding from simple applications.</p>
<p>To conduct this analysis, we prepare data into a two column table, with columns date and AQI. Prophet uses the trends of past data to highlight similarities over days of the year, weeks, months, and seasons. From this, prophet is able to generate its predictions, cross validate, and give performance metrics such as mean absolute percentage error to quantify the accuracy of the results</p>
</section>
<section id="sarimax" class="level2">
<h2 class="anchored" data-anchor-id="sarimax">SARIMAX​​</h2>
<p>The most common method used in time series forecasting is known as the ARIMA model. We will use an extended version called SARIMAX (<em>Seasonal Auto Regressive Integrated Moving Averages with exogenous factor</em>)</p>
<ul>
<li><em>(S) Seasonality</em>: Accounts for recurring patterns or cycles in the data.</li>
<li><em>(AR) AutoRegressive</em>: Uses past values to predict future values.</li>
<li><em>(I) Integrated</em>: Applies differencing to make the time series stationary.</li>
<li><em>(MA) Moving Average</em>: Uses past forecast errors in the prediction.</li>
<li><em>(X) eXogenous factors</em>: Incorporates external variables that may influence the forecast.</li>
</ul>
<p>The SARIMAX model is used when the data sets have seasonal cycles. In the dataset concerning the air quality/AQI there is a seasonal pattern. SARIMAX can be fitted to time series data in order to better understand or predict future points. SARIMAX is particularly useful for forecasting time series data that exhibits both trends and seasonality. There are three distinct integers (p,d,q) that are used to parametrize SARIMAX models. Because of that, SARIMAX models are denoted with the notation SARIMAX(p,d,q). Together these three parameters account for seasonality, trend, and noise in datasets:</p>
<ul>
<li><em>p</em> is the auto-regressive part of the model. It allows us to incorporate the effect of past values into our model.</li>
<li><em>d</em> is the integrated part of the model. This includes terms in the model that incorporate the amount of differencing (the number of past time points to subtract from the current value) to apply the time series.</li>
<li><em>q</em> is the moving average part of the model. This allows us to set the error of our model as a linear combination of the error values observed at previous time points in the past.</li>
</ul>
<p>We use a tuning technique called grid search method that attempts to compute the optimum values of the hyperparameters. We are trying to find the right p,d,q values that would be given as an input to the SARIMAX time series model.</p>
</section>
<section id="akaike-information-criteria-aic" class="level2">
<h2 class="anchored" data-anchor-id="akaike-information-criteria-aic">Akaike Information Criteria (AIC)</h2>
<p>&lt;&lt;&lt;&lt;&lt;&lt;&lt; Updated upstream The Akaike Information Criterion (AIC) is a measurement used to compare different statistical models. It helps in model selection by balancing the goodness of fit and the complexity of the model. When comparing two models, the one with the lower AIC is generally “better”. ======= The Akaike Information Criterion (AIC) was formulated by the statistician Hirotsugu Akaike, is a measure used to compare different statistical models. It helps in model selection by balancing the goodness of fit and the complexity of the model. When comparing two models, the one with the lower AIC is generally “better”.</p>
<p>The Akaike Information Criterion (AIC) is defined as:</p>
<p><span class="math display">\[
\text{AIC} = 2k - 2\ln(\hat{L})
\]</span></p>
<p>Where:</p>
<ul>
<li>( k ) is the number of parameters in the model.</li>
<li>( ) is the maximum value of the likelihood function for the model.</li>
<li>( () ) is the natural logarithm of the likelihood function.</li>
</ul>
<section id="interpretation" class="level3">
<h3 class="anchored" data-anchor-id="interpretation">Interpretation</h3>
<ul>
<li><strong>Likelihood Function (())</strong>: Measures how well the model fits the data. A higher likelihood indicates a better fit.</li>
<li><strong>Penalty Term ((2k))</strong>: Accounts for the number of parameters in the model, penalizing more complex models to avoid overfitting.</li>
</ul>
</section>
<section id="usage" class="level3">
<h3 class="anchored" data-anchor-id="usage">Usage</h3>
<p>When comparing multiple models, the model with the lowest AIC value is generally preferred because it offers a better balance between goodness of fit and complexity.</p>
</section>
<section id="example" class="level3">
<h3 class="anchored" data-anchor-id="example">Example</h3>
<p>For a linear regression model, the likelihood function () is calculated based on the residual sum of squares (RSS). The formula can be expressed as:</p>
<p><span class="math display">\[
\text{AIC} = 2k + n \ln\left(\frac{\text{RSS}}{n}\right)
\]</span> Where ( n ) is the number of observations. Here, RSS is the sum of the squared differences between the observed and predicted values, reflecting the model’s fit to the data. &gt;&gt;&gt;&gt;&gt;&gt;&gt; Stashed changes</p>
<p>Here’s how to interpret the AIC value:</p>
<ul>
<li><em>AIC Value</em>: A lower AIC value indicates a better-fitting model. It means the model has a good balance between accuracy and complexity.</li>
<li><em>Comparative Measure</em>: AIC is most useful when comparing multiple models. The model with the lowest AIC among a set of candidate models is generally preferred.</li>
<li><em>Penalty for Complexity</em>: AIC includes a penalty for the number of parameters in the model. This discourages overfitting by penalizing models that use more parameters without a corresponding improvement in fit.</li>
</ul>
</section>
</section>
<section id="train-test-split" class="level2">
<h2 class="anchored" data-anchor-id="train-test-split">Train-Test-Split</h2>
<p>Rigorous validation is paramount to establishing the model’s reliability and practical application. To ensure the model’s generalizability, we will employ a train-test split. This approach safeguards against overfitting by exposing the model to unseen data, allowing for a more accurate assessment of its predictive capabilities.</p>
<p>By partitioning the dataset, we can:</p>
<ul>
<li><em>Evaluate performance</em>: Measure the model’s accuracy on unseen data.</li>
<li><em>Detect overfitting</em>: Identify discrepancies between training and testing performance.</li>
<li><em>Assess generalization</em>: Determine the model’s ability to handle new data.</li>
<li><em>Quantify reliability</em>: Calculate confidence intervals for prediction accuracy.</li>
<li><em>Iteratively improve</em>: Use insights to refine the model.</li>
</ul>
<p>This rigorous process underpins the credibility and utility of our research findings. To split the data, we follow the recommended 70:30 ratio, 70% of the data is the training data, and 30% of the data is the testing data.</p>
</section>
<section id="hypothesis-testing" class="level2">
<h2 class="anchored" data-anchor-id="hypothesis-testing">Hypothesis Testing</h2>
<p>Hypothesis tests for significance are conducted to understand the significance of differences in datasets. Statistics are done in R using a variety of statistical methods and measurements:</p>
<ul>
<li><em>Null Hypothesis</em>: This serves as the baseline of a hypothesis test. It represents the idea that there is no effect, difference, or relationship between tested variables. Any observed differences are due to random chance.</li>
<li><em>Alternate Hypothesis</em>: On the other hand, the alternative hypothesis suggests a potential effect, difference, or relationship between tested variables exists. It reflects what is hoped to be found by the data.</li>
<li><em>Independence</em>: The idea that data in one sample or population has no impact on the data in another sample or population.</li>
<li><em>Normal Distribution</em>: A continuous probability distribution symmetric around the mean. It is characterized by mean and standard deviation.</li>
<li><em>Normal QQ Plot</em>: A plot to measure the normality of a distribution. It compares the quantiles of a dataset against the quantiles of a theoretical normal distribution. Data is mapped along a y=x trendline. Deviations of the data from the trendline indicate non normality. An “S” shaped bend suggests data with heavy or light tails. A convex or concave bend suggests skewness in the distribution.</li>
<li><em>Histogram</em>: Plot that displayed data frequencies of values within specified intervals known as bins. Histograms are used to visualize the shape and spread of a distribution.</li>
<li><em>Welch Two Sample t-test</em>: This type of hypothesis test measures the statistical significance of the difference in mean of the two samples. Unlike the Student’s two sample t-test, the Welch two-sample t-test is used in cases where the groups being compared have unequal variances. A Welch two sample t-test includes the following:
<ul>
<li><em>t-Statistic (t)</em>: Difference between sample means relative to variance of samples. Larger t-statistics indicate larger differences between means.</li>
<li><em>Degrees of Freedom (df)</em>: Amount of information available to estimate variance of sample means.</li>
<li><em>p-Value</em>: The probability of observing the sample data or something more extreme if the null hypothesis is true. A small p-value (&lt; 0.05) suggests the observed difference is statistically significant.</li>
<li><em>95 Percent Confidence Interval</em>: Range in which the true difference in means is 95% likely to lie within.</li>
</ul></li>
</ul>
</section>
<section id="machine-learning" class="level2">
<h2 class="anchored" data-anchor-id="machine-learning">Machine Learning</h2>
<p>Machine learning is done in scikit-learn, an open source ML library built in Python. It is built on top of other common Python libraries such as NumPy, Pandas, and Matplotlib. The following tools are used:</p>
<ul>
<li><em>One Hot Encoder</em>: Transforms categorical data into a binary matrix. Each category is represented as a vector where one element is tagged with a 1 and all others are tagged as 0. This is done for certain machine learning algorithms that require all discrete data.</li>
<li><em>Standard Scaler</em>: Used to normalize or standardize numerical data. Certain machine learning algorithms are affected by unscaled data and therefore require normalized data.</li>
<li><em>Transformer</em>: Can be used to change multiple variables in one step in methods such as One Hot Encoder and Standard Scaler.</li>
<li><em>Pipeline</em>: Allows multiple functions in a series of steps that can include transformers and models. Incorporates chaining to supply the output of one step as the input of the next step.</li>
<li><em>Feature Selection</em>: Chooses a subset of most relevant features, with the ability to specify how many features.</li>
<li><em>Hyperparameter Optimization</em>: Selects the best set of hyperparameters in a model. These hyperparameters are set before training and control various aspects of the training process and model behavior. The optimization method used is a Randomized search. This evaluates a fixed number of random combinations from a specified distribution. This is far more efficient than a Grid search which systematically checks every single combination of the specified hyperparameter distribution.</li>
<li><em>Cohen Kappa Score</em>: A statistical measure used to assess agreement between two classifiers when they categorize items into classes. In ML specifically, the Cohen Kappa Score is used to evaluate agreement between predicted and actual labels in classification algorithms. It is measured on a scale from -1 to 1, where 1 represents perfect agreement in classifiers, 0 represents agreement being no better or worse than random chance, and -1 represents perfect disagreement.</li>
<li><em>Random Forest Model</em>: An ensemble model used in prediction tasks. It combines multiple decision trees and aggregates their predictions to improve performance and reduce overfitting.</li>
<li><em>Confusion Matrix</em>: Measures and visualizes the accuracy of a classification model. It breaks down raw numbers of correctly and incorrectly classified values.</li>
<li><em>Classification Report</em>: A detailed evaluation of the prediction model. Includes:
<ul>
<li><em>Precision</em>: The ratio of correctly predicted positive observations to the total predicted positives</li>
<li><em>Recall</em>: The ratio of correctly predicted positive observations to all observations</li>
<li><em>F1 score</em>: Mean of precision and recall</li>
<li><em>Support</em>: Number of observations</li>
</ul></li>
</ul>
<p>Reference Machine Learning Metrics Table in Appendix for additional information.</p>
</section>
</section>
<section id="data" class="level1">
<h1>Data</h1>
<p>The data for this project was initially scattered across multiple sources and required significant organization and compilation. The focus of this project is on the air quality in Portland, Oregon, so various data sources were aggregated and processed to compare a variety of air quality indicators. There is a significant amount of missing data due to incomplete collection which will be addressed via filling in and row dropping.</p>
<section id="air-quality-data" class="level3">
<h3 class="anchored" data-anchor-id="air-quality-data">Air Quality Data</h3>
<p>Air quality data, specifically AQI values, were obtained from the United States Environmental Protection Agency (EPA) pre generated data files. The AQI values are calculated daily, based on a variety of factors including criteria gasses and measured pollutant concentrations, and measures how harmful breathing the air is. AQI is classified into one of six categories from ‘good’ to ‘hazardous’, each having long term health effects associated with it. The files were given daily on a county wide basis, separated into different files by year. After stacking year outputs together in R, columns regarding date, location (state, county), AQI, and AQI category were brought into the database.</p>
</section>
<section id="meteorological-data" class="level3">
<h3 class="anchored" data-anchor-id="meteorological-data">Meteorological Data</h3>
<p>Historical weather data was also sourced from the EPA database, measured by thousands of weather stations across the country. Measurements tracked include temperature, wind speed, air pressure, and humidity. Temperature is measured in degrees fahrenheit. Wind speed is measured in knots, which are defined as one nautical mile per hour (equivalent to approximately 1.15mph). Wind speed is important in air quality as winds can blow different pollutants around and move and spread wildfires. Pressure is measured in millibars, where 1013.25 millibars is the standard atmospheric pressure (Earth’s pressure at mean sea level). Finally, humidity is measured in percent relative humidity. This is the amount of water vapor in the air as a percentage of the maximum amount of water vapor possible at a given temperature. Humidity can make it more difficult to breathe and sweat, make the air feel hotter than it is, and prevent air pollutants from dispersing as easily. This data was given daily by city, separated into different files by year. Measurements were taken hourly, but pre-aggregated in the source database, giving an average value over the twenty four hours and a maximum value. After stacking years in R, columns regarding date, location (state, city), weather observation average and maximum, and observation unit were brought into the database.</p>
</section>
<section id="pollution-source-data" class="level3">
<h3 class="anchored" data-anchor-id="pollution-source-data">Pollution Source Data</h3>
<p>Pollution data was again sourced from the EPA database, separated by criteria gasses (CO, NO2, O3, SO2), Toxins (lead), and particulate matter (PM2.5 and PM10). Criteria gas Carbon Monoxide (CO) is measured in parts per million, and is especially dangerous as it is both colorless and odorless. CO binds to hemoglobin in the blood, making the transportation of oxygen around the body more difficult. Nitrogen Dioxide (NO2) is dangerous to breathe in at high levels. It can cause swelling in the throat, burning, reduced oxygenation of body tissues, and fluid build up in the lungs. It is released in many common combustion reactions including in cars, coal plants, and cigarettes. It is measured in parts per billion. Ozone (O3) can harm our ability to breathe, especially in older people, children, and people with asthma. It is measured in parts per million. Sulfur Dioxide (SO2), measured in parts per billion, can irritate the eyes, mucous membranes, skin, and the respiratory tract. Lead is a toxin which can increase the risk of high blood pressure, cardiovascular problems, and complications during pregnancy. While exposure has gone down significantly in the recent decades after use in gasoline, it still remains a dangerous toxin to breathe in. It is measured in micrograms per cubic meter. PM2.5 and PM10 are particulate matter, small inhalable particles with diameters of 2.5 microns or smaller, and 10 microns or smaller respectively. PM2.5 includes all sorts of common particles, metals, and organic compounds. PM10 includes dust, pollen, molds, and other larger (but still very small) particles. Due to the variability of particles included in the PM classification, there are a wide range of negative health impacts that come from breathing in these particles. PM2.5 and PM10 are measured in micrograms per cubic meter.</p>
<p>This data was given daily by city, separated into different files by year. They are sourced from thousands of individual sources, which measure various selections of these pollution sources. Because of the variety of different pollutants being measured, there was a significant amount of missing data, especially from small towns. Measurements were taken hourly, pre-compiled into a daily average and maximum. After stacking years in R, columns regarding date, location (state, city), pollutant observation average and maximum, and observation unit were brought into the database.</p>
</section>
<section id="public-transit-data" class="level3">
<h3 class="anchored" data-anchor-id="public-transit-data">Public Transit Data</h3>
<p>Information on motor buses was taken from the National Transit Database, produced by the Federal Transit Administration. It includes information of bus systems and ridership by city, separated by year. Data is recorded yearly, encompassing annual totals for information such as number of buses, total revenue, passengers, and miles driven for the respective city transit systems. Information was given in yearly CSVs, separated by the city transit system. For cities with multiple systems, data was combined. Only motorbus data was compiled, which may not be reflective of cities with other large methods of public transportation, such as the New York subway system. Only public transit information was able to be collected. Accessible data on cars and trucks could not be found. This will be further discussed in the limitations section of the conclusion. After stacking years in R, columns regarding date, location (state, city), transport mode, number of buses, passenger trips in hours and miles, and bus operations in hours and miles were brought into the database.</p>
</section>
<section id="land-area-data" class="level3">
<h3 class="anchored" data-anchor-id="land-area-data">Land Area Data</h3>
<p>City and county area data was collected from the 2020 U.S. Census, collected by the U.S. Census Bureau. It is measured in km<sup>2</sup>. City, county, state, city area, and county area columns were brought into the database.</p>
</section>
<section id="park-area-data" class="level3">
<h3 class="anchored" data-anchor-id="park-area-data">Park Area Data</h3>
<p>Park area data is sourced from the Trust for Public Land’s 2024 annual City Park Survey. This information is collected via survey from a variety of park agencies including individual parks and recreation agencies, the National Park Service, the Bureau of Land Management, regional park authorities, private conservancies, watershed management agencies, private park services, and more. Totals are compiled by the Trust for Public Land, and measured in acres. Only location (city, state) and park area columns are brought into the database.</p>
</section>
<section id="livestock-data" class="level3">
<h3 class="anchored" data-anchor-id="livestock-data">Livestock Data</h3>
<p>Information on livestock numbers was collected on a county wide basis from the 2017 United States Census of Agriculture by the National Agricultural Statistics Service within the United States Department of Agriculture. Cattle include cows and bulls raised for meat consumption, cows for milk production, and calves. Hogs includes all pigs, adult and adolescent. Although there are colloquial differences for the animals called hogs and pigs, they refer to the same species, though ‘hogs’ generally refers to the larger members of the species. Sheep includes sheep raised for wool production and lambs. Numbers may have slight inaccuracies for areas with low numbers to prevent disclosing identifying information and are marked with a ‘D’. All of these data points will be replaced with zero. Location (county, state) and livestock varieties (cattle and calves, hogs, sheep and lambs) columns are collected and added to the database.</p>
</section>
<section id="population-data" class="level3">
<h3 class="anchored" data-anchor-id="population-data">Population Data</h3>
<p>Data on population and population density was sourced from the Simplemaps United States Cities database, which is built from multiple sources including the U.S. Geological Survey and the U.S. Census Bureau. Data was last updated on May 6, 2024, reflecting very up to date information.</p>
</section>
<section id="data-organization" class="level2">
<h2 class="anchored" data-anchor-id="data-organization">Data Organization</h2>
<p>Given the raw data available, the table structure was simplified compared to the original data sources. Data was organized around the air_quality table. This table tracks AQI, pollutant, weather and toxin data daily for each location. It includes all 1438 locations with a line for each of the 2922 days in the eight year time period, reaching a total of over 4.2 million rows. Location is split into a separate table to reduce repeated data. This table lists cities, labeled with their city name, county, and state. It includes metropolitan area population data given in raw numbers and as a density. Additionally, this table includes the city area in square kilometers and park area in acres. The aqi_category table is a short list of AQI value categories (Good, Unhealthy, Hazardous, etc.) with their respective AQI value range as minimum and maximum values. The yearly_transit table is connected to the location table and gives the information for the transit system of the respective city during the specified year. Finally, the livestock table, also connected via locations, includes counts for cattle, hogs, and sheep.</p>
<p>The central table has a compound primary key composed of location_id and date. Each other table has a serialized primary key, which are used to connect to each other. Several additional indexes are included on columns that will be queried often. Finally, constraints have been added to limit unusual or impossible data. For example, an AQI value less than 0 or greater than 500 would be impossible and thus would be caught by the constraint.</p>
<p>Tracking these identifiers independently allows for accurate analysis of changes over time and across different areas, and allows adding new information should we need to update the database. Figure 1 illustrates the resulting ERD diagram using drawSQL.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/wu-msds-capstones/Air-Quality-Index/blob/main/images/erd_diagram_final_extended.png?raw=true" class="img-fluid figure-img"></p>
<figcaption>Figure 1: ERD diagram</figcaption>
</figure>
</div>
</section>
</section>
<section id="prophet-aqi-trend-forecasting-and-statistical-testing" class="level1">
<h1>Prophet AQI Trend Forecasting and Statistical Testing</h1>
<p>To gain an understanding of how Portland’s AQI differs from other large cities, we can start by running a hypothesis test to determine the significance.</p>
<p>Initially we can run a two sample t-test to show that Portland’s AQI average is statistically greater than the average AQI of all large metropolitan areas within the US. We compare the sample of Portland AQI datapoints in the time period with the sample of all metropolitan areas with a population greater than one million.</p>
<p><strong>Null Hypothesis</strong>: The Portland AQI is greater than or equal to the AQI of all large metro cities in the US.</p>
<p><strong>Alternate Hypothesis</strong>: The Portland AQI is less than the AQI of all large metro cities in the US.</p>
<p><strong>Assumptions</strong>:</p>
<ol type="1">
<li><p>Simple Random Sample: Data is a simple random sample. We have selected 10% of values from each population set.</p></li>
<li><p>Independence: AQI in Portland does not affect AQI in the rest of the country. However, the dataset for the large metro areas does include Portland, so Portland AQI will be repeated within both population groups. Both groups are largely independent, though this should be noted.</p></li>
<li><p>Normal Distribution:</p></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/wu-msds-capstones/Air-Quality-Index/blob/main/images/normal_distribution_1_pdx_vs_lma.png?raw=true" class="img-fluid figure-img"></p>
<figcaption>Figure 2: PDX Vs Large Metro Areas Distribution</figcaption>
</figure>
</div>
<p>From the QQ plots and histograms, we can see both datasets are clearly not normally distributed. They have long tails to the right. However, since the tails have such low frequencies and the samples are very large, this likely will not impact the results.</p>
<p>The partial violations of the assumptions in the t-test in our analysis suggest that the conclusions should be considered with a degree of caution.</p>
<p><strong>Two-Sample t-Test Portland AQI vs Large Metro Areas AQI</strong></p>
<p><img src="https://github.com/wu-msds-capstones/Air-Quality-Index/blob/main/images/hypothesis_test_results_1_pdx_vs_lma.png?raw=true" class="img-fluid"></p>
<p>Based on the low P-value of 6.862*10<sup>-4</sup>, we can safely reject the null hypothesis. We conclude that Portland’s AQI mean is not greater than or equal to the AQI of all large metropolitan areas. This agrees with our initial observations on the greater AQI outcomes of Portland, and specifies the significance of this statistically.</p>
<section id="data-forecasting-with-prophet" class="level2">
<h2 class="anchored" data-anchor-id="data-forecasting-with-prophet">Data Forecasting with Prophet</h2>
<p>Prophet by Meta is used as time series prediction to estimate and map trends based on our data. We use this to see how AQI trends vary by day, month, and year. It is also able to give us a forecast for a given period after the end of our data which we can analyze and use to anticipate future AQI values.</p>
<p>To use the package, data must be in the format of a two column graph, with the first column being the date data, and the second being the variable being mapped and predicted. In this case, this predicted variable is AQI.</p>
<p>The package allows a future period to be generated, which can be specified and added to the end of the time data. It can then predict future AQI values for the new data period.</p>
<p>The graph below (figure 3), shows the supplied data with the forecast over the future period. The actual values are shown with the black datapoints, and the blue line represents the prediction. The upper and lower bounds of the error are represented with the transparent blue area. Each year, the data spikes during the late summer to early fall. Even more significant, is the large spike in September 2020. What caused it? How significant was it?</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/wu-msds-capstones/Air-Quality-Index/blob/main/images/prophet_pdx_trend_and_prediction.png?raw=true" class="img-fluid figure-img"></p>
<figcaption>Figure 3: Prophet Trend and Prediction with 2020 Wildfire Season Highlight</figcaption>
</figure>
</div>
</section>
<section id="wildfires" class="level2">
<h2 class="anchored" data-anchor-id="wildfires">2020 Wildfires</h2>
<p>In September 2020, a wildfire ravaged the state of Oregon, as well as many other areas of the United States and Canada. The fires burned more than one million acres of land, destroying thousands of homes, and killing 11 people. 500,000 Oregonians were on evacuation alert, and 40,000 were actually forced to leave (Oregon Department of Emergency Management). Anyone around during that time will recall the orange skies, thick atmosphere, and strong smoke smell, but how unusual was this period actually?</p>
<p>To understand, we will conduct a two sample t-test to see whether or not this month had greater than usual AQI.</p>
<p><strong>Null Hypothesis</strong>: September 2020 AQI is less than or equal to AQI of entire period in Portland</p>
<p><strong>Alternate Hypothesis</strong>: September 2020 AQI is greater AQI of entire period in Portland</p>
<p><strong>Assumptions</strong>:</p>
<ol type="1">
<li><p>Simple Random Sample: Data is not a simple random sample. Since there are so few datapoints for the September 2020 population (30 datapoints), taking a 10% sample may not be suitable to accurately capture the variance of this month. Thus, it was decided to use the entire population as the sample. A 10% sample will be taken of the entire Portland data population.</p></li>
<li><p>Independence: AQI in September 2020 does not affect AQI in the rest of the timeframe.</p></li>
<li><p>Normal Distribution:</p></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/wu-msds-capstones/Air-Quality-Index/blob/main/images/normal_distribution_2_wildfires.png?raw=true" class="img-fluid figure-img"></p>
<figcaption>Figure 4: Wildfire Distribution</figcaption>
</figure>
</div>
<p>From the QQ plots and histograms, we can see both datasets are clearly not normally distributed. They have long tails to the right, and the September 2020 dataset is oddly shaped due to lack of data.</p>
<p>The partial violations of the assumptions in the t test in our analysis suggest that the conclusions should be considered with a degree of caution.</p>
<p><strong>Two-Sample t-Test September 2020 vs Full Period of Portland AQI</strong></p>
<p><img src="https://github.com/wu-msds-capstones/Air-Quality-Index/blob/main/images/hypothesis_test_results_2_wildfires.png?raw=true" class="img-fluid"></p>
<p>Based on the low p value of 1.85*10<sup>-3</sup>, we reject the null. We conclude that the September AQI in Portland is not less than or equal to the AQI for the entire period. The wildfire had a significant effect on the air quality, making it much more difficult to breathe. This aligns with the observation of the large spike during this period. We must do more to address and combat the wildfires that not only harm the air we breathe, but cause long lasting damage to the local environment.</p>
</section>
<section id="aqi-trends" class="level2">
<h2 class="anchored" data-anchor-id="aqi-trends">AQI Trends</h2>
<p>Prophet’s plot component function allows us to see specific trends including the total (entire eight years), weekly, and yearly trends in figure 5.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/wu-msds-capstones/Air-Quality-Index/blob/main/images/prophet_components_plot_aqi.png?raw=true" class="img-fluid figure-img"></p>
<figcaption>Figure 5: Prophet Component Trend Aggregations</figcaption>
</figure>
</div>
<p>This allows us to see how AQI changes by day. In the top full time span graph, it shows the potential spread of data for the predicted period with the transparent blue area. We can also see that day of the week tends to have very little impact on the trend (it may look significant but it is only moving up and down less than 1.5 AQI between days). Finally, from the yearly graph we can see the consistent increase during the late summer to mid fall each year.</p>
</section>
<section id="cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation">Cross Validation</h2>
<p>How accurate are these predictions? A cross validation predicts over the period from the cutoff date up to specified date.</p>
<p>Cross validating the predictions allows us to create many estimates from a starting date up to an end date within our timeframe. In this instance, the tool predicts using start dates every half a year. It will predict AQI for that date to every day up to a year after the start date, giving us 365 estimates per start date. We then compare all estimations, seeing how accurate the prediction is for a number of days after the start date.</p>
<p>The tool allows us to measure the difference in predicted y and actual y with a variety of different measurements. In figure 6 below, we have selected mean absolute percent error, to show if the error on average increased as the prediction got further from the starting point.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/wu-msds-capstones/Air-Quality-Index/blob/main/images/prophet_cross_val_aqi.png?raw=true" class="img-fluid figure-img"></p>
<figcaption>Figure 6: Prophet Error on Cross Validated Estimates</figcaption>
</figure>
</div>
<p>The light grey datapoints represent the mean absolute percent error. A datapoint with a x value 200 and y value 1 means it was predicted for a period of 200 days after the cutoff date, and was 1% off the actual value. We can see that most predictions are under 1%, making this a pretty decent estimation. The fact that they do not increase over time allows us to have a certain degree of confidence in the prediction even a year out. The blue line shows the mean of these predictions.</p>
</section>
<section id="portlands-transit-system" class="level2">
<h2 class="anchored" data-anchor-id="portlands-transit-system">Portland’s Transit System</h2>
<p>As shown in the graphs and tests above, Portland has greater than normal AQI outcomes when compared with other cities of high populations. The AQI follows certain yearly trends, with the notable exception in September 2020 due to the large wildfires. Using Prophet, we are able to predict AQI up to a year out of the final datapoint in the time period. What exactly is the reason for these outcomes in this city?</p>
<p>One hypothesis for Portland’s better air quality outcomes is due to the increased focus on public transportation. Portland has placed high emphasis on utilizing public transit, with rates comparable to larger cities and higher than most other cities of its size. We will run a two sample t test to see how Portland’s rate of ridership compares with other large cites.</p>
<p>We have standardized rates by passenger miles ridden per person. This is the total amount of miles ridden in a given year divided by the population. This allows us to properly compare cities with different population sizes.</p>
<p><strong>Null Hypothesis</strong>: Transit ridership in Portland is less than or equal to transit ridership across the country (large metro areas only).</p>
<p><strong>Alternate Hypothesis</strong>: Transit ridership in Portland is greater than transit ridership across the country (large metro areas only).</p>
<p><strong>Assumptions</strong>:</p>
<ol type="1">
<li><p>Simple Random Sample: Data is not a simple random sample. Since there are so few datapoints for the Portland transit ridership population (8 datapoints), taking a 10% sample may not be suitable to accurately capture the variance of this month. Thus, it was decided to use the entire population as the sample. A 10% sample will be taken of the large cities transit population.</p></li>
<li><p>Independence: Transit ridership in Portland does not affect transit ridership in the rest of the country.</p></li>
<li><p>Normal Distribution:</p></li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/wu-msds-capstones/Air-Quality-Index/blob/main/images/normal_distribution_3_pdx_transit.png?raw=true" class="img-fluid figure-img"></p>
<figcaption>Figure 7: Transit Distribution</figcaption>
</figure>
</div>
<p>From the QQ plots and histograms, we can see both datasets are clearly not normally distributed. The Portland data has so few datapoints that it is hard to tell if it has a normal distribution or not. The large city transit data seems fairly normal, though it too does not have enough datapoints to visually approach a bell curve in the histogram.</p>
<p>The partial violations of the assumptions in the t test in our analysis suggest that the conclusions should be considered with a degree of caution.</p>
<p><strong>Two-Sample t-Test Portland Transit Ridership vs Large Metro Area Ridership</strong></p>
<p><img src="https://github.com/wu-msds-capstones/Air-Quality-Index/blob/main/images/hypothesis_test_results_3_transit.png?raw=true" class="img-fluid"></p>
<p>Based on the high p value of 0.2469, we fail to reject the null. We cannot conclude that Portland’s transit ridership is different from the average transit ridership of other large metro areas across the country. Transit ridership may have some impact on AQI but not enough to make a statistical difference by itself. Likely, this is a situation of correlated variables. Cities that invest more in public infrastructure are more likely to make a concerned effort into being environmentally conscious.</p>
<p>It should also be noted that some cities have higher public transit numbers not reflected in the data. For example, in New York City, subway ridership is almost double that of its motor bus numbers. In this data, only motor bus numbers were included which may contribute to the lack of evidence for transit numbers influence on AQI. We will explore which features have a greater effect on AQI in the upcoming Machine Learning section.</p>
</section>
</section>
<section id="machine-learning-with-scikit-learn" class="level1">
<h1>Machine Learning with Scikit-Learn</h1>
<p>Ultimately, we want to see which variables have the greatest impact on AQI. To do this we perform a machine learning analysis and create a prediction algorithm. As the AQI is defined by the four criteria gasses and particulate matter (PM10 and PM2.5), those should not be included in the algorithm. Thus we start with all the other variables.</p>
<p>After data is cleaned, we are left with a total of eighteen cities across the country with a total metropolitan area population of greater than one million. To perform the ML prediction algorithm, AQI will be predicted. We will use existing AQI categories as classifiers. A feature selector is run on the set of all variables except for the six that define AQI (CO, NO2, O3, SO2, PM10, PM2.5). This chooses the best predictors of the dependent variable AQI.</p>
<p>Features Selected in Initial Model:</p>
<ul>
<li>City</li>
<li>Month</li>
<li>Population</li>
<li>City Area</li>
<li>Park Area</li>
<li>Temperature</li>
<li>Humidity</li>
<li>Cattle</li>
</ul>
<p>In pre testing, it was found that a Random Forest Model performed the best on this dataset. Therefore, this model type is used in all models.</p>
<p>An initial Random Forest Model run with the selected features returns the following Cohen Kappa score and accuracy:</p>
<div id="cks-accuracy" class="cell" data-execution_count="23">
<div class="cell-output cell-output-stdout">
<pre><code>Cohen Kappa Score:  0.4540612461353385
Accuracy:  0.7272727272727273</code></pre>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/wu-msds-capstones/Air-Quality-Index/blob/main/images/confusion_matrix_1.png?raw=true" class="img-fluid figure-img"></p>
<figcaption>Figure 11: Confusion Matrix For Bin Size 1</figcaption>
</figure>
</div>
<p>Looking only at Cohen Kappa score and accuracy, this seems like a good prediction model. However, the confusion matrix shows the data’s skew, centered around the 0-100 range. Therefore, more bins and bin size combinations are tested in order to provide a more meaningful prediction.</p>
<p>After further testing the following bins were decided on:</p>
<ul>
<li>0-25</li>
<li>26-50</li>
<li>51-75</li>
<li>76-100</li>
<li>101-200</li>
<li>201-500</li>
</ul>
<p>As bins are made smaller, predictions become far less accurate. This bin size serves as a good balance between having enough bins to generate conclusions and maintaining decent accuracy. Different bin sizes also lead to different features being selected. The following features will be present in the final model:</p>
<ul>
<li>City</li>
<li>Population</li>
<li>City Area</li>
<li>Park Area</li>
<li>Temperature</li>
<li>Humidity</li>
<li>Cattle</li>
</ul>
<p>Hyperparameter optimization will be done to further improve the model. A randomized search is run with 100 iterations. The following hyperparameters are optimized:</p>
<ul>
<li>Max Categories</li>
<li>Min Frequency</li>
<li>Max Depth</li>
<li>Max Features</li>
<li>Min Samples Leaf</li>
<li>Min Samples Split</li>
<li>Num Estimators</li>
<li>Bootstrap</li>
</ul>
<p>Table 1 below shows the selected hyperparameters.</p>
<div id="cell-randsearch-get-params" class="cell" data-execution_count="34">
<div id="randsearch-get-params" class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Parameter</th>
<th data-quarto-table-cell-role="th">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>RF_model__bootstrap</td>
<td>True</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>RF_model__max_depth</td>
<td>8</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>RF_model__max_features</td>
<td>None</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>RF_model__min_samples_leaf</td>
<td>4</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>RF_model__min_samples_split</td>
<td>7</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>RF_model__n_estimators</td>
<td>147</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>aqi_transformer__categories__max_categories</td>
<td>5</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">7</td>
<td>aqi_transformer__categories__min_frequency</td>
<td>8</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Table 2 below shows the selected hyperparameters having hyperparamenter optimization</p>
<p>Using these hyperparameters, we reach an accuracy of over 70%.</p>
<div id="predict-x_test-final" class="cell" data-execution_count="35">
<div class="cell-output cell-output-stdout">
<pre><code>Cohen Kappa Score:  0.46261234174643673
Accuracy:  0.7158410451823626</code></pre>
</div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/wu-msds-capstones/Air-Quality-Index/blob/main/images/confusion_matrix_final.png?raw=true" class="img-fluid figure-img"></p>
<figcaption>Figure 12: Final Model Confusion Matrix</figcaption>
</figure>
</div>
<p>We can use this model for the prediction of AQI, exploring the features that predict it, and use that to generate conclusions for what variables or systems should be addressed.</p>
<p>Below, the table 3 shows a classification report of the model. Support represents the amount of data points total in that bin. We can see that AQI groups with more data tend to be more accurate (higher f1-score). This makes sense as the model has more of this data to train on. To make the model more accurate, more data from AQI values outside this 26-200 range will need to be collected.</p>
<div id="cell-classification-report" class="cell" data-execution_count="37">
<div id="classification-report" class="cell-output cell-output-display">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">precision</th>
<th data-quarto-table-cell-role="th">recall</th>
<th data-quarto-table-cell-role="th">f1-score</th>
<th data-quarto-table-cell-role="th">support</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0-25</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>5.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">26-50</td>
<td>0.785470</td>
<td>0.869442</td>
<td>0.825326</td>
<td>1057.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">51-75</td>
<td>0.613240</td>
<td>0.584718</td>
<td>0.598639</td>
<td>602.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">76-100</td>
<td>0.387755</td>
<td>0.175926</td>
<td>0.242038</td>
<td>108.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">101-200</td>
<td>0.568182</td>
<td>0.416667</td>
<td>0.480769</td>
<td>60.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">201-500</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>5.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Table 3: Final Model Classification Report)</p>
<p>We can also take a look at which features end up being most influential in the model. Below figure 13 shows Temperature and Humidity being by far the most influential variables in the model. However, temperature and humidity are not variables we can directly impact easily, and therefore, the four other variables are where we should put our efforts.</p>
<div id="cell-feature-importance" class="cell" data-execution_count="38">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="capstone_files/figure-html/feature-importance-output-1.png" id="feature-importance" width="667" height="509" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Figure 13: Feature Importance of Selected Variables in Final Model</p>
</section>
<section id="machine-learning-sarimax" class="level1">
<h1>Machine Learning SARIMAX</h1>
<p>A time series is a sequence of data points collected at regular intervals over a period of time. These intervals are typically uniform, such as hourly, daily, or quarterly measurements.<br>
This orderly arrangement allows for the analysis of trends, patterns, and behaviors over time.<br>
Common examples of time series data include stock market closing prices, household electricity consumption readings, and weather measurements.</p>
<p>In the context of our capstone project, we’re focusing on air quality index measurements as our time series data. This sequential record of air quality provides insights into pollution trends and can be used to forecast future air quality conditions.</p>
<p>Any time series is composed of three things:</p>
<ul>
<li><em>Trend</em>: Trend tells you how things are overall changing<br>
</li>
<li><em>Seasonality</em>: Seasonality shows you how things change within a given period (e.g.&nbsp;year,month, week, day)<br>
</li>
<li><em>Residual</em>: The Error/residual/irregular activity are the anomalies which cannot be explained by the trend or the seasonal value</li>
</ul>
<section id="statsmodel" class="level2">
<h2 class="anchored" data-anchor-id="statsmodel">Statsmodel</h2>
<p>Using the statsmodel package, we can map the seasonal pattern and trends using seasonal_decompose method. It requires as inputs a dataframe with two columns date data and the AQI.</p>
</section>
<section id="components-of-a-time-series" class="level2">
<h2 class="anchored" data-anchor-id="components-of-a-time-series">Components Of A Time Series</h2>
<p>Time series decomposition is a statistical technique that separates data into three key components: trend, seasonality, and residuals.<br>
The trend shows the long-term direction, seasonality reveals recurring patterns, and residuals represent unexplained variations.<br>
Visualizing these components individually provides insights that may not be evident in the raw data. This process helps analysts identify underlying patterns, recognize cyclical behaviors, and detect anomalies. By understanding these elements separately, we can gain deeper insights into the factors driving the time series, leading to more accurate analysis and forecasting.</p>
<p>Decomposition is particularly useful when the complexity of a time series makes it challenging to discern important patterns from simple observation of the dataset.</p>
<div id="cell-seasonal-decompose" class="cell" data-execution_count="42">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="capstone_files/figure-html/seasonal-decompose-output-1.png" id="seasonal-decompose" width="760" height="614" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Figure 14: Seasonal, Trend, and Residual Decomposition of Portland AQI Time Series</p>
<p>The uppermost graph, labeled <em>Observed</em>, presents the raw time series data as originally recorded. Its y-axis quantifies the daily air quality measurements, while the x-axis represents the passage of time.<br>
This graph is a composite representation, effectively combining the three underlying components: trend, seasonality, and residuals.<br>
A notable anomaly is evident in the data: a significant spike in air quality measurements occurring in September 2020. This outlier corresponds to the severe wildfires that ravaged Oregon during that period. The dramatic increase in air pollution levels during this time underscores the profound impact of extreme environmental events on air quality.</p>
<p>The <em>Seasonal</em> component graph illustrates the cyclical patterns in air quality that repeat annually. This visualization reveals a distinctive yearly pattern in Air Quality Index (AQI) fluctuations. The cycle begins with relatively low AQI values, indicating better air quality. As the year progresses, the AQI rises to a peak, signifying a period of poorer air quality. This is followed by an improvement (decrease in AQI), another deterioration (increase), and a final improvement towards the year’s end.</p>
<p>These recurring variations likely reflect the influence of seasonal factors such as changing weather patterns, temperature inversions, and seasonal human activities. For instance, winter months might see higher AQI due to increased heating emissions, while spring could bring lower AQI with more favorable dispersion conditions.<br>
The graph includes a highlighted box that demarcates the seasonal period. This visual element clearly illustrates the duration and boundaries of one complete seasonal cycle in the air quality data. Understanding these seasonal trends is crucial for accurately interpreting air quality data and making informed predictions.<br>
It allows environmental agencies and policymakers to anticipate periods of potentially compromised air quality and plan interventions accordingly.</p>
<p>Lastly, the final row displays the <em>Residuals</em>, which represent the portion of the data not explained by the trend or the seasonal component. We can interpret the residuals as the difference between the sum of the Trend and Seasonal components and the Observed values at each point in time.</p>
<p>Essentially, the Residuals indicate the amount that needs to be added to the Trend and Seasonal components to align the result with the Observed values. Residuals are typically attributed to random errors, often referred to as noise. These residuals embody the unpredictable elements of the data that cannot be captured or forecasted by the model, as they are inherently random.</p>
</section>
<section id="finding-the-best-forecasting-model-with-grid-search" class="level2">
<h2 class="anchored" data-anchor-id="finding-the-best-forecasting-model-with-grid-search">Finding the Best Forecasting Model with Grid Search</h2>
<p>For this project, we used an extended version of <em>ARIMA</em> model knows as <em>SARIMAX</em> model as we have explained in the methods section. We use a tuning technique called grid search method that attempts to compute the optimum values of hyperparameters. We are trying to find the right p,d,q values that would be given as an input to the SARIMAX time series model.</p>
<p>Here’s an easy-to-understand explanation of how this works:</p>
<section id="step-1-setting-up-our-hyperparameters" class="level3">
<h3 class="anchored" data-anchor-id="step-1-setting-up-our-hyperparameters">Step 1: Setting Up Our Hyperparameters</h3>
<p>We define p,d,q hyperparameters to take any value between 0 to 1 which help the model decide how much weight to give to past values, trends, and patterns.<br>
We then create a list of all p,d,q possible combinations of these settings in a for loop.</p>
</section>
<section id="step-2-trying-out-different-combinations" class="level3">
<h3 class="anchored" data-anchor-id="step-2-trying-out-different-combinations">Step 2: Trying Out Different Combinations</h3>
<p>We go through each combination of settings to see how well each one works. For each main setting, we also try different seasonal settings to find the perfect combination.</p>
</section>
<section id="step-3-checking-the-results" class="level3">
<h3 class="anchored" data-anchor-id="step-3-checking-the-results">Step 3: Checking the Results</h3>
<p>For each set of p,d,q settings, we create a forecasting model and test it on our data. We measure how well each model works using a score called the Akaike Information Criterion (AIC) as mentioned in the methods section. This score tells us how well the model predicts the data, with lower scores being better.</p>
<p>If something goes wrong with a particular set of hyperparameter settings, we catch the error and move on to the next set without stopping the whole process.</p>
<p>We have found the lowest AIC values which would have the best corresponding p,d,q values to have the best forecast of AQI values.</p>
</section>
</section>
<section id="sarimax-model-results" class="level2">
<h2 class="anchored" data-anchor-id="sarimax-model-results">SARIMAX Model Results</h2>
<table class="table-striped table-hover caption-top table">
<caption>SARIMAX Results</caption>
<colgroup>
<col style="width: 100%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>SARIMAX Results</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Dep. Variable:</strong> aqi</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Model:</strong> SARIMAX(1, 1, 1)x(0, 1, 1, 12)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Date:</strong> Thu, 15 Aug 2024</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Time:</strong> 12:09:16</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Sample:</strong> 01-31-2015 - 12-31-2022</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>No.&nbsp;Observations:</strong> 96</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Log Likelihood:</strong> -330.316</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>AIC:</strong> 668.632</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>BIC:</strong> 678.307 (Bayesian Information Criterion)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>HQIC:</strong> 672.519 (Hannan-Quinn Information Criterion)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>Covariance Type:</strong> opg (Outer Product of Gradients)</td>
</tr>
</tbody>
</table>
<section id="interpretation-1" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-1">Interpretation</h3>
<p>This summary presents a concise overview of the SARIMAX model’s performance and fit.</p>
<p>The SARIMAX(1, 1, 1)x(0, 1, 1, 12) model integrates both non-seasonal and seasonal components, effectively capturing both immediate and periodic influences on the Air Quality Index (AQI). The model utilizes 96 observations, providing a robust dataset for accurate model fitting.</p>
<p>Key metrics such as the log-likelihood, AIC, BIC, and HQIC are used to assess the model’s effectiveness, with lower values typically indicating a better fit that balances complexity and accuracy.</p>
<p>The summary also includes the date and time of model execution, the timeframe of the data, and the type of covariance used, which aids in understanding how the model accounts for uncertainties in parameter estimates.</p>
<p>Next, we extract the coefficient, standard errors, z-values, p-values, and 95% confidence intervals for the SARIMAX model parameters. This information is crucial for evaluating the significance and reliability of each parameter estimate</p>
</section>
<section id="autoregressive-term-ar.l1" class="level3">
<h3 class="anchored" data-anchor-id="autoregressive-term-ar.l1">Autoregressive Term (ar.L1)</h3>
<ul>
<li>Coefficient: 0.0483 Suggests a slight positive influence of the previous observation on the current value.</li>
<li>Standard Error: 0.306 Indicates significant variability in the coefficient estimate.</li>
<li>Z-Value: 0.158 Low value, indicating the coefficient is not statistically significant.</li>
<li>P-Value: 0.875 Not significant (p-value &gt; 0.05).</li>
<li>Confidence Interval: [-0.551, 0.648]</li>
<li>Includes zero, reinforcing the lack of significance.</li>
</ul>
</section>
<section id="moving-average-term-ma.l1" class="level3">
<h3 class="anchored" data-anchor-id="moving-average-term-ma.l1">Moving Average Term (ma.L1)</h3>
<ul>
<li>Coefficient: -1.0000 Implies the model tries to correct nearly all errors from the previous period.</li>
<li>Standard Error: 924.523 Extremely large, pointing to high uncertainty in the estimate.</li>
<li>Z-Value: -0.001 Near zero, indicating no statistical significance.</li>
<li>P-Value: 0.999 Not significant.</li>
<li>Confidence Interval: [-1813.031, 1811.031] Very wide and includes zero, confirming lack of significance.</li>
</ul>
</section>
<section id="seasonal-moving-average-term-ma.s.l12" class="level3">
<h3 class="anchored" data-anchor-id="seasonal-moving-average-term-ma.s.l12">Seasonal Moving Average Term (ma.S.L12)</h3>
<ul>
<li>Coefficient: -1.0000 Attempts to correct errors regarding data seasonality.</li>
<li>Standard Error: 2355.498 Very large, indicating substantial uncertainty.</li>
<li>Z-Value: -0.000 Near zero, suggesting no significance.</li>
<li>P-Value: 1.000 Not significant.</li>
<li>Confidence Interval: [-4617.692, 4615.692] Wide interval, includes zero, further indicating no significance.</li>
</ul>
</section>
<section id="variance-of-the-residuals-sigma2" class="level3">
<h3 class="anchored" data-anchor-id="variance-of-the-residuals-sigma2">Variance of the Residuals (sigma2)</h3>
<ul>
<li>Coefficient: 134.1503 Represents the variance of the residuals or errors.</li>
<li>Standard Error: 335000 Extremely high, showing great uncertainty.</li>
<li>Z-Value: 0.000 Indicates no statistical significance.</li>
<li>P-Value: 1.000 Not significant.</li>
<li>Confidence Interval: [-657000, 657000] Very wide, includes zero, highlighting lack of significance.</li>
</ul>
</section>
</section>
<section id="fit-sarimax-model" class="level2">
<h2 class="anchored" data-anchor-id="fit-sarimax-model">Fit SARIMAX model</h2>
<div id="extract-aic-value-plot" class="cell" data-execution_count="45">
<div class="cell-output cell-output-stdout">
<pre><code>The AIC value is: 668.6317406918595</code></pre>
</div>
</div>
<p>When working with SARIMAX models, there are typically several plots you might analyze, such as:</p>
<ul>
<li><em>Time Series Plot of Residuals</em>: Shows the residuals over time. Ideally, residuals should appear as random noise without clear patterns.</li>
<li><em>ACF and PACF Plots of Residuals</em>: Autocorrelation Function (ACF) and Partial Autocorrelation Function (PACF) plots help identify if the residuals of the model are uncorrelated. For a well-fitting model, residual autocorrelations should be small and within the significance bounds.</li>
<li><em>Q-Q Plot</em>: This plot compares the distribution of residuals to a normal distribution. Points should ideally lie along the line of best fit.</li>
<li><em>Forecast Plot</em>: Displays the fitted values versus the actual values and includes forecasted values. A good model will have fitted values close to the actual values with narrow confidence intervals</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://github.com/wu-msds-capstones/Air-Quality-Index/blob/main/images/final-plot.png?raw=true" class="img-fluid figure-img"></p>
<figcaption>Figure 15: Diagnostic plots</figcaption>
</figure>
</div>
<p>Once the model is created, predicted values are generated using the .get_prediction() method, with datetime as input.</p>
<p>To facilitate comparison of true and predicted test values, we will create a separate DataFrame. Mean Error Estimation will be used for analysis.</p>
<p>To evaluate model performance, we calculate the MSE.</p>
<div id="calculate-mse" class="cell" data-execution_count="50">
<div class="cell-output cell-output-stdout">
<pre><code>The Mean Squared Error of our forecasts is 0.83</code></pre>
</div>
</div>
<p>In the context of predicting the Air Quality Index (AQI), the Mean Squared Error (MSE) is indeed an indicator of the average squared difference between the predicted AQI values and the actual AQI values.</p>
</section>
<section id="forecasting-future-values" class="level2">
<h2 class="anchored" data-anchor-id="forecasting-future-values">Forecasting Future Values</h2>
<p>As we conclude our modeling process, we generate predictions for the next 30 data points:</p>
<ol type="1">
<li><p><strong>Model Information</strong>: The <code>result</code> variable contains our fitted model’s details.</p></li>
<li><p><strong>Forecasting Method</strong>: We use the <code>.get_forecast()</code> method on our model results.</p></li>
<li><p><strong>Prediction Generation</strong>: This method analyzes observed patterns in our data to project future values.</p></li>
<li><p><strong>Output</strong>: We obtain forecasts for the next 30 time points, representing predicted air quality levels.</p></li>
</ol>
<p>This step transforms our analytical work into actionable insights for air quality management.</p>
</section>
<section id="visualizing-our-results" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-our-results">Visualizing Our Results</h2>
<p>The final and crucial step of our project is the creation of a comprehensive plot that encapsulates our complex analysis. This visualization serves as the key to understanding and interpreting our findings.</p>
<section id="interpreting-the-forecast-plot" class="level3">
<h3 class="anchored" data-anchor-id="interpreting-the-forecast-plot">Interpreting the Forecast Plot</h3>
<p>Our plot consists of several key elements:</p>
<ol type="1">
<li><strong>Observed Values (Blue Line)</strong>
<ul>
<li>Represents the actual, historical air quality measurements</li>
<li>Provides a baseline for comparing our predictions</li>
</ul></li>
<li><strong>Forecasted Values (Orange Line)</strong>
<ul>
<li>Depicts the future air quality levels predicted by our SARIMAX Time Series Model</li>
<li>Allows us to visualize potential trends and patterns in air quality</li>
</ul></li>
<li><strong>Confidence Interval (Shaded Region)</strong>
<ul>
<li>The shaded area around the forecast line represents the 95% Confidence Interval (CI)</li>
<li>Indicates the range within which we can be 95% confident that the true future values will fall</li>
<li>Wider intervals suggest greater uncertainty in the prediction</li>
</ul></li>
</ol>
<p>This visual representation not only summarizes our extensive data analysis but also provides a powerful tool for understanding potential future air quality trends. It bridges the gap between complex statistical models and actionable insights, making our findings accessible and meaningful to a broader audience.</p>
<div id="cell-plot-forecast" class="cell" data-execution_count="53">
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="capstone_files/figure-html/plot-forecast-output-1.png" id="plot-forecast" width="746" height="583" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Figure 16: Portland AQI Plot Forecast from 2023 to 2025</p>
</section>
<section id="overall-conclusion" class="level3">
<h3 class="anchored" data-anchor-id="overall-conclusion">Overall Conclusion</h3>
<p>None of the coefficients in the SARIMAX model are statistically significant, as indicated by the high p-values and z-values close to zero. This means that the parameters do not effectively predict the AQI data. The large standard errors and wide confidence intervals point to a high degree of uncertainty in the parameter estimates. This suggests the model may not be well-suited for capturing the dynamics of the AQI data, and re-evaluation of the model or data is recommended. Our conclusion is that the SARIMAX model did not predict well the forecast values of the air quality index (AQI).</p>
</section>
<section id="possible-reasons-for-poor-performance" class="level3">
<h3 class="anchored" data-anchor-id="possible-reasons-for-poor-performance">Possible Reasons for Poor Performance</h3>
<p>Model Mis-specification: The chosen order of the SARIMAX model, including the autoregressive, differencing, and moving average components, may not be suitable for capturing the dynamics of the AQI data. This can lead to the model failing to capture trends and seasonal patterns accurately.</p>
<ul>
<li><p><em>Overfitting or Underfitting</em>: A high p-value for the model coefficients suggests that these parameters are not statistically significant. This could be a sign of overfitting, where the model is too complex and captures noise instead of the underlying pattern, or underfitting, where the model is too simple to capture the complexity of the data.</p></li>
<li><p><em>Residual Diagnostics</em>: The residuals from the SARIMAX model may not be normally distributed or might exhibit autocorrelation, as seen in the plot diagnostics. This violation of assumptions indicates that the model is not capturing all the patterns in the data.</p></li>
<li><p><em>External Influences</em>: The SARIMAX model may not account for all external factors influencing AQI, such as sudden changes in weather conditions, wildfires, or policy changes affecting pollution levels.</p></li>
<li><p><em>SARIMAX model</em>: The SARIMAX model is quite intricate and can be challenging to comprehend fully.</p></li>
</ul>
</section>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>After conducting our thorough research, we have landed on these specific recommendations. We found there are high seasonal trends where late summer/early fall tends to have the worst air quality. These numbers consistently show up each year, exasperated by the dry heat and lack of rainfall. As climate change raises temperatures and water sources dry up, wildfire season will continue to get worse over time. We must be aware of the nature of air quality and how it differs at different parts of the year. We should understand how the AQI works, and avoid being outside for too long when it reaches more dangerous levels.</p>
<p>Air quality is significantly affected by various natural and unpredictable elements, including:</p>
<ul>
<li>Weather conditions</li>
<li>Wind speed and direction</li>
<li>Temperature fluctuations</li>
<li>Humidity levels</li>
<li>Atmospheric pressure</li>
<li>Solar radiation intensity</li>
</ul>
<p>With multiple factors we have no control over, it is important to do what we can for those factors we can impact.</p>
<p>We must focus on the variables that have the greatest impact on the AQI. These are city, temperature, humidity, CO, NO2, O3, PM10, and PM2.5. City, temperature, and humidity for the most part are out of our control. That leaves us with three criteria gasses and all particulate matter. The largest source of carbon monoxide, nitrogen dioxide, and ozone is the cars, trucks, and other vehicles we use daily (Environmental Protection Agency). We can lower our reliance on personal vehicles by utilizing public transportation, carpooling, walking, biking, increasing work from home to lower commutes when available, and overall be more considerate about if driving a car is necessary. We often drive unnecessarily, out of convenience or impatience.</p>
<p>For many Americans, personal vehicles are required. Many urban and suburban areas lack proper public transportation, or existing public transportation systems are inadequate, unreliable, and infrequent. Many towns and cities in the United States were designed for cars instead of for people. Fixing this will require a substantial overhaul, necessitating millions or billions of dollars in spending. This is not to say that we shouldn’t bother—any investment that increases the public transportation system’s usage decreases the amount of cars on the road. A small change is the first step in addressing the personal vehicle issue.</p>
<p>Industrial manufacturing processes and agriculture are significant polluters of the environment. We should invest in the research of more environmentally friendly manufacturing methods, working with materials that require less combustion, or are recyclable. Agricultural reduction starts with less of a reliance on red meat and the dairy industry, mainstays of the American diet. This will be a huge shift, taking combined efforts of the citizens, government, and food industry. As red meat and dairy consumption goes down, possibly due to the replacement with artificial or lab grown meat, less livestock will need to be kept, and less feeding crops will need to be grown (Congressional Budget Office). It will be a difficult transition but a necessary one.</p>
<p>Wildfires not only increase the particle matter in the air, but burn forests, causing long term damage to the soil. Particulate matter in the air makes it more difficult to breathe, which is reflected by the increased AQI levels. Not all forest fires are started by man made sources, but many are. Therefore, when in the woods, one should always obey fire restrictions, especially in the middle of the summer when it’s most dry. If fires are allowed, they should always be watched and never left unattended. They must always be properly extinguished and all embers must be cool to the touch before leaving. Campsites should be properly cleaned, and all tools used correctly. One should also stay on marked trails, avoiding trampling vegetation which can increase the risk of wildfire spreading (Oregon Wildfire Response and Recovery).</p>
<p>One of the largest limitations is Algorithm Dependence. This is the reliability of forecasts which are inherently tied to the chosen predictive algorithms. Different models may yield varying results, emphasizing the importance of algorithm selection and validation.</p>
<p>We must also be wary of geographical considerations. Our data analysis couldn’t fully quantify the unique geographical features of Portland and the broader Willamette Valley region. In further analysis we should seek to understand:</p>
<ul>
<li>The protective influence of surrounding mountain ranges</li>
<li>The impact on wind patterns and air circulation</li>
<li>The potential effects of wildfires on air quality</li>
</ul>
<p>These geographical factors play a significant role in local air quality dynamics but were beyond the scope of our current data set. The impact of the geological features can be seen in the image below illustrates how the surrounding mountains create a basin effect, trapping pollutants and contributing to higher air pollution levels. The concentrated red and orange areas, particularly on right side of the Willamette Valley.Do the mountains in the image seem to create barriers to air flow, potentially trapping pollutants in certain areas? <img src="https://github.com/wu-msds-capstones/Air-Quality-Index/blob/main/images/AirNow-Map.png?raw=true" class="img-fluid" alt="AirNow Interactive Map"></p>
<p>By recognizing these limitations, we can better interpret and apply our forecasting results, while also identifying areas for future research and data collection to enhance prediction accuracy.</p>
<p>Ultimately, we have a responsibility to take care of our planet and combat climate change. The worse climate conditions get, the more wildfires will spread, and the worse the air quality will become. As time goes on, with worsening air conditions, more people will catch and even die from preventable conditions sparked by poor air quality. Water, pollution, food, and financial problems will get worse. One should look at what they can do to make a difference, support those who vouch to make larger changes, and encourage people they know to do the same. While the situation may seem dire, there is hope for progress through concerted and informed efforts.</p>
</section>
<section id="appendix" class="level1">
<h1>Appendix</h1>
<section id="bibliography" class="level2">
<h2 class="anchored" data-anchor-id="bibliography">Bibliography</h2>
<ol type="1">
<li><p>Airly. (n.d.). <em>How does humidity affect air quality? All you need to know</em>. <a href="https://airly.org/en/how-does-humidity-affect-air-quality-all-you-need-to-know/">airly.org/en/how-does-humidity-affect-air-quality-all-you-need-to-know/</a></p></li>
<li><p>AirNow. (n.d.). <em>Using air quality index</em>. <a href="https://www.airnow.gov/aqi/aqi-basics/using-air-quality-index">www.airnow.gov/aqi/aqi-basics/using-air-quality-index</a></p></li>
<li><p>American Lung Association. (n.d.). <em>Key findings: State of the air</em>. <a href="https://www.lung.org/research/sota/key-findings">www.lung.org/research/sota/key-findings</a></p></li>
<li><p>Broadbent, P., Grantz, D. A., &amp; Leigh, A. (2023). Air quality in cities: Complexities and progress in mitigation. <em>Frontiers in Sustainable Cities</em>, <em>5</em>. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC10068020/">www.ncbi.nlm.nih.gov/pmc/articles/PMC10068020/</a></p></li>
<li><p>California Air Resources Board. (n.d.). <em>Carbon monoxide &amp; health</em>. <a href="https://ww2.arb.ca.gov/resources/carbon-monoxide-and-health">ww2.arb.ca.gov/resources/carbon-monoxide-and-health</a></p></li>
<li><p>Centers for Disease Control and Prevention, Agency for Toxic Substances and Disease Registry. (2014, October 21). <em>Medical management guidelines for sulfur dioxide</em>. <a href="https://wwwn.cdc.gov/TSP/MMG/MMGDetails.aspx?mmgid=249&amp;toxid=46">wwwn.cdc.gov/TSP/MMG/MMGDetails.aspx?mmgid=249&amp;toxid=46</a></p></li>
<li><p>Centers for Disease Control and Prevention, Agency for Toxic Substances and Disease Registry. (2023, April 12). <em>Toxic substances portal - Nitrogen oxides</em>. <a href="https://wwwn.cdc.gov/TSP/ToxFAQs/ToxFAQsDetails.aspx?faqid=396&amp;toxid=69">wwwn.cdc.gov/TSP/ToxFAQs/ToxFAQsDetails.aspx?faqid=396&amp;toxid=69</a></p></li>
<li><p>Climate &amp; Clean Air Commission. (n.d.). Methane. Retrieved August 14, 2024, from https://www.ccacoalition.org/short-lived-climate-pollutants/methane</p></li>
<li><p>Congressional Budget Office. (2023, May). <em>Reducing emissions from transportation</em>. <a href="https://www.cbo.gov/publication/60030">www.cbo.gov/publication/60030</a></p></li>
<li><p>Environmental Protection Agency. (n.d.-a). <em>Evolution of the Clean Air Act</em>. <a href="https://www.epa.gov/clean-air-act-overview/evolution-clean-air-act">www.epa.gov/clean-air-act-overview/evolution-clean-air-act</a></p></li>
<li><p>Environmental Protection Agency. (n.d.). Agriculture and aquaculture: Food for thought. Retrieved August 14, 2024, from https://www.epa.gov/snep/agriculture-and-aquaculture-food-thought</p></li>
<li><p>Environmental Protection Agency. (n.d.-b). <em>Health effects of ozone pollution</em>. <a href="https://www.epa.gov/ground-level-ozone-pollution/health-effects-ozone-pollution">www.epa.gov/ground-level-ozone-pollution/health-effects-ozone-pollution</a></p></li>
<li><p>Environmental Protection Agency. (n.d.-c). <em>Particulate matter (PM) basics</em>. <a href="https://www.epa.gov/pm-pollution/particulate-matter-pm-basics">www.epa.gov/pm-pollution/particulate-matter-pm-basics</a></p></li>
<li><p>Federal Transit Administration. (n.d.). <em>NTD data tables</em>. American Public Transportation Association. <a href="https://www.apta.com/research-technical-resources/transit-statistics/ntd-data-tables/">www.apta.com/research-technical-resources/transit-statistics/ntd-data-tables/</a></p></li>
<li><p>Fuller, R., Landrigan, P. J., Balakrishnan, K., Bathan, G., Bose-O’Reilly, S., Brauer, M., Caravanos, J., Chiles, T., Cohen, A., Corra, L., Cropper, M., Ferraro, G., Hanna, J., Hanrahan, D., Hu, H., Hunter, D., Janata, G., Kupka, R., Lanphear, B., . . . Yadama, G. N. (2022). Pollution and health: A progress update. <em>The Lancet Planetary Health</em>, <em>6</em>(6), e535-e547. <a href="https://www.thelancet.com/journals/lanplh/article/PIIS2542-5196(22)00090-0/fulltext">www.thelancet.com/journals/lanplh/article/PIIS2542-5196(22)00090-0/fulltext</a></p></li>
<li><p>Hog Wild Preserve. (n.d.). <em>Pig, boar, or hog: What’s the difference?</em> <a href="https://www.hogwildok.com/blog/336-pig,-boar,-or-hog-what-s-the-difference.html">www.hogwildok.com/blog/336-pig,-boar,-or-hog-what-s-the-difference.html</a></p></li>
<li><p>Jacobs, E. T., Burgess, J. L., &amp; Abbott, M. B. (2018). The Donora smog revisited: 70 years after the event that inspired the clean air act. <em>American Journal of Public Health</em>, <em>108</em>(S2), S85-S88. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5922205/">www.ncbi.nlm.nih.gov/pmc/articles/PMC5922205/</a></p></li>
<li><p>Manisalidis, I., Stavropoulou, E., Stavropoulos, A., &amp; Bezirtzoglou, E. (2020). Environmental and health impacts of air pollution: A review. <em>Frontiers in Public Health</em>, <em>8</em>, 14. <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7044178/">www.ncbi.nlm.nih.gov/pmc/articles/PMC7044178/</a></p></li>
<li><p>National Agricultural Statistics Service. (2017). <em>2017 Census of Agriculture</em>. United States Department of Agriculture. <a href="https://www.nass.usda.gov/Publications/AgCensus/2017/Full_Report/Volume_1,_Chapter_1_US/">www.nass.usda.gov/Publications/AgCensus/2017/Full_Report/Volume_1,_Chapter_1_US/</a></p></li>
<li><p>National Oceanic and Atmospheric Administration. (n.d.). <em>What are a nautical mile and a knot?</em> <a href="https://oceanservice.noaa.gov/facts/nautical-mile-knot.html">oceanservice.noaa.gov/facts/nautical-mile-knot.html</a></p></li>
<li><p>National Weather Service. (n.d.). <em>Pressure and winds</em>. <a href="https://www.weather.gov/source/zhu/ZHU_Training_Page/winds/pressure_winds/Pressure.htm">www.weather.gov/source/zhu/ZHU_Training_Page/winds/pressure_winds/Pressure.htm</a></p></li>
<li><p>Oregon Encyclopedia. (n.d.). <em>Interstate 5 in Oregon</em>. <a href="https://www.oregonencyclopedia.org/articles/interstate_5_in_oregon/">www.oregonencyclopedia.org/articles/interstate_5_in_oregon/</a></p></li>
<li><p>Oregon Wildfire Response and Recovery. (n.d.). <em>Wildfire prevention</em>. <a href="https://wildfire.oregon.gov/prevention">wildfire.oregon.gov/prevention</a></p></li>
<li><p>Portland.gov. (n.d.). <em>City of Portland Charter, Chapter 1</em>. <a href="https://www.portland.gov/charter/1/2">www.portland.gov/charter/1/2</a></p></li>
<li><p>Shandas, V., &amp; George, L. (2009). Neighborhood, neighborhood, neighborhood: Spatial patterns of air toxins and implications for metroscape residents and urban planners. <em>Metroscape</em>, Winter 2009. <a href="https://pdxscholar.library.pdx.edu/cgi/viewcontent.cgi?article=1033&amp;context=usp_fac">pdxscholar.library.pdx.edu/cgi/viewcontent.cgi?article=1033&amp;context=usp_fac</a></p></li>
<li><p>Trust for Public Land. (n.d.). <em>Park data downloads</em>. <a href="https://www.tpl.org/park-data-downloads">www.tpl.org/park-data-downloads</a></p></li>
<li><p>United States Census Bureau. (n.d.). <em>Home page</em>. <a href="https://www.census.gov/en.html">www.census.gov/en.html</a></p></li>
<li><p>World Health Organization. (2014, March 25). <em>7 million premature deaths annually linked to air pollution</em>. <a href="https://www.who.int/news/item/25-03-2014-7-million-premature-deaths-annually-linked-to-air-pollution">www.who.int/news/item/25-03-2014-7-million-premature-deaths-annually-linked-to-air-pollution</a></p></li>
<li><p>World Health Organization. (2022, October 31). <em>Lead poisoning and health</em>. <a href="https://www.who.int/news-room/fact-sheets/detail/lead-poisoning-and-health">www.who.int/news-room/fact-sheets/detail/lead-poisoning-and-health</a></p></li>
<li><p>Zhang, Y., Cooper, O. R., Gaudel, A., Thompson, A. M., Nédélec, P., Ogino, S. Y., &amp; West, J. J. (2018). Tropospheric ozone change from 1980 to 2010 dominated by equatorward redistribution of emissions. <em>Nature Geoscience</em>, <em>11</em>, 637-644. <a href="https://acp.copernicus.org/articles/18/15003/2018/">acp.copernicus.org/articles/18/15003/2018/</a></p></li>
</ol>
</section>
<section id="additional-resources---eda" class="level2">
<h2 class="anchored" data-anchor-id="additional-resources---eda">Additional Resources - EDA</h2>
<section id="exploratory-data-analysis" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-data-analysis">Exploratory Data Analysis</h3>
<p>We have new dataset metro_1mil.csv. This file was generated using a SQL statement that joins all relevant tables, filtering for metropolitan areas with populations less than or equal to 1 million. This approach limits our EDA to mid-sized metropolitan cities, such as Portland, Oregon.</p>
<p>Let’s plot the AQI data distribution</p>
<p>The DataFrame contains 147039 rows and 44 columns.</p>
<p>By filtering our Dataframe for Oregon state, our DataFrame contains 2922 rows.</p>
</section>
<section id="features-engineering" class="level3">
<h3 class="anchored" data-anchor-id="features-engineering">Features Engineering</h3>
<p>Date Column Preprocessing:</p>
<ul>
<li>Converted the date column to DateTime objects for easier manipulation and analysis.</li>
<li>Extracted additional time-based features: year, month, day of week, and quarter.</li>
</ul>
<p>Feature Selection:</p>
<ul>
<li>Removed irrelevant columns to focus the analysis on pertinent variables.</li>
<li>Retained features: pollutant, aqi, wind</li>
</ul>
<p>Missing Value Treatment:</p>
<ul>
<li>Identified columns with missing values: most all of them</li>
<li>Applied mean() imputation method for numerical columns.</li>
<li>For categorical columns: n/a</li>
</ul>
<p>Data Types and Memory Usage:</p>
<ul>
<li>Optimized data types to reduce memory usage (e.g., using categories for low-cardinality strings, int8/int16 for small integers).</li>
</ul>
<p>Basic Statistics:</p>
<ul>
<li>Generated summary statistics for numerical columns using df.describe().</li>
<li>Calculated frequency distributions for categorical variables.</li>
</ul>
<p>Distribution Analysis:</p>
<ul>
<li>Plotted histograms and kernel density estimates for main numerical features.</li>
</ul>
<p>Time Series Components:</p>
<ul>
<li>Decomposed time series data into trend, seasonality, and residual components for relevant variables.</li>
</ul>
</section>
<section id="sweetviz-data-report" class="level3">
<h3 class="anchored" data-anchor-id="sweetviz-data-report">Sweetviz Data Report</h3>
<p>We have generated Sweetviz statistical report confirming the quality of EDA steps.</p>
</section>
<section id="advanced-data-analysis" class="level3">
<h3 class="anchored" data-anchor-id="advanced-data-analysis">Advanced Data Analysis</h3>
<p>We have also employed the ydata-profiling package, a powerful Time Series Analysis EDA package that offers more detailed analysis.</p>
<p>We have unlocked time series-specific features using ydata-profiling: We ensure our DataFrame is sorted or specify the sortby parameter, setting tsmode=True when creating the ProfileReport to allow Time Series Feature Identification</p>
<p>The ydata-profiling identifies time-dependent features using autocorrelation analysis.<br>
For recognized time series features, the histograms are replaced with line plots and feature details include new autocorrelation and partial autocorrelation plots.</p>
<p>To handle Multi-Entity Time Series Data, In our case, with category_id, each pollutants represents a distinct time series. For optimal analysis, we filter and profile each pollutant separately</p>
<p>To conclude our exploratory data analysis (EDA) process consisted of two complementary approaches:</p>
<ul>
<li><em>Manual Investigation</em>: We conducted an in-depth, hands-on examination of the dataset.</li>
<li><em>Automated Analysis</em>: We leveraged two powerful EDA packages: Sweetviz For quick, visual data summaries, ydata-profiling for more detailed, customizable reports</li>
</ul>
<p>These methods allowed us to thoroughly evaluate key data quality aspects, including:</p>
<ul>
<li>Class balance in categorical variables</li>
<li>Presence and distribution of missing values (NaN)</li>
<li>Feature distributions and correlations</li>
<li>Potential time-series characteristics</li>
</ul>
<p>This multi-faceted approach ensures a robust understanding of our dataset’s structure, quality, and potential challenges before proceeding with further analysis.</p>
</section>
<section id="time-series-visualization-in-portland" class="level3">
<h3 class="anchored" data-anchor-id="time-series-visualization-in-portland">Time Series Visualization in Portland</h3>
<section id="carbon-monoxyde-co-wind-and-air-quality-index-aqi" class="level4">
<h4 class="anchored" data-anchor-id="carbon-monoxyde-co-wind-and-air-quality-index-aqi">Carbon Monoxyde (CO), Wind and Air Quality Index (AQI)</h4>
<p>CO pollutant refers to carbon monoxide, which is a colorless, odorless, and tasteless gas that can be harmful to human health and the environment. Here’s some key information about CO as a pollutant:</p>
<p>Primarily produced by incomplete combustion of carbon-containing fuels Major sources include vehicle exhaust, industrial processes, and some natural sources like volcanoes</p>
<ul>
<li>Slightly less dense than air</li>
<li>Highly flammable</li>
</ul>
<div id="ts-wind-co-aqi" class="cell" data-execution_count="67">
<div id="ts-wind-co-aqi-1" class="cell-output cell-output-display">
<pre><code>&lt;Figure size 960x1728 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="capstone_files/figure-html/ts-wind-co-aqi-output-2.png" id="ts-wind-co-aqi-2" width="3542" height="1130" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="nitrogen-dioxide-no2-sulfur-dioxyde-so2-and-ozone-o₃" class="level4">
<h4 class="anchored" data-anchor-id="nitrogen-dioxide-no2-sulfur-dioxyde-so2-and-ozone-o₃">Nitrogen Dioxide (NO2), Sulfur Dioxyde (SO2) and Ozone (O₃)</h4>
<p>NO2 (nitrogen dioxide) is an important air pollutant. - Reddish-brown gas with a pungent odor - Part of a group of pollutants known as nitrogen oxides (NOx)</p>
<p>SO2 (sulfur dioxide) is an important air pollutant. - Colorless gas with a sharp, pungent odor - Highly soluble in water</p>
<p>Ozone (O₃) as a pollutant is a complex topic, as it can be both beneficial and harmful depending on its location in the atmosphere. - Colorless to pale blue gas with a distinctive smell - Highly reactive molecule composed of three oxygen atoms</p>
<div id="ts-so2-no2-ozone" class="cell" data-execution_count="68">
<div id="ts-so2-no2-ozone-1" class="cell-output cell-output-display">
<pre><code>&lt;Figure size 1440x1920 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="capstone_files/figure-html/ts-so2-no2-ozone-output-2.png" id="ts-so2-no2-ozone-2" width="3542" height="1695" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="additional-resources---machine-learning-metrics-table" class="level2">
<h2 class="anchored" data-anchor-id="additional-resources---machine-learning-metrics-table">Additional Resources - Machine Learning Metrics Table</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 26%">
<col style="width: 19%">
<col style="width: 25%">
<col style="width: 28%">
</colgroup>
<thead>
<tr class="header">
<th>Technique/Metric</th>
<th>Description</th>
<th>Purpose/Formula</th>
<th>Scenario: Cancer prediction</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1. Train-Test Split</td>
<td>Split the dataset into training and testing subsets</td>
<td>Assess model performance on unseen data to detect overfitting and ensure generalizability</td>
<td>Always used; crucial for unbiased evaluation of model performance</td>
</tr>
<tr class="even">
<td>2. Cross-Validation</td>
<td>Divide data into k subsets and train the model k times, using a different subset as test set each time</td>
<td>Provides robust estimate of model performance by averaging results over multiple splits</td>
<td>Useful for smaller datasets or when data collection is expensive (e.g., rare cancer types)</td>
</tr>
<tr class="odd">
<td>3. Confusion Matrix</td>
<td>Table comparing predicted and actual values in classification</td>
<td>Metrics: True Positives (TP), True Negatives (TN), False Positives (FP), False Negatives (FN)</td>
<td>Fundamental for understanding model performance in classification tasks, like cancer detection</td>
</tr>
<tr class="even">
<td>4. Accuracy</td>
<td>Ratio of correctly predicted instances to total instances</td>
<td><span class="math inline">\(\frac{TP + TN}{TP + TN + FP + FN}\)</span></td>
<td>Used when classes are balanced; less suitable for rare cancer detection due to class imbalance</td>
</tr>
<tr class="odd">
<td>5a. Precision</td>
<td>Ratio of correctly predicted positive observations to total predicted positives</td>
<td><span class="math inline">\(\frac{TP}{TP + FP}\)</span></td>
<td>Important when false positives are costly (e.g., unnecessary biopsies or treatments)</td>
</tr>
<tr class="even">
<td>5b. Recall (Sensitivity)</td>
<td>Ratio of correctly predicted positive observations to all actual positive observations</td>
<td><span class="math inline">\(\frac{TP}{TP + FN}\)</span></td>
<td>Critical in cancer detection to minimize false negatives (missed cancer cases)</td>
</tr>
<tr class="odd">
<td>5c. F1-Score</td>
<td>Harmonic mean of Precision and Recall</td>
<td><span class="math inline">\(2 \times \frac{\text{Precision} \times \text{Recall}}{\text{Precision} + \text{Recall}}\)</span></td>
<td>Balances precision and recall; useful when seeking a compromise between false positives and false negatives</td>
</tr>
<tr class="even">
<td>6. ROC Curve and AUC</td>
<td>ROC: Graph of true positive rate vs false positive rate at various thresholds. AUC: Area under ROC curve</td>
<td>Higher AUC indicates better model performance</td>
<td>Useful for comparing models and choosing optimal threshold, especially in diagnostic tests</td>
</tr>
<tr class="odd">
<td>7. Mean Absolute Error (MAE)</td>
<td>Average of absolute differences between predicted and actual values</td>
<td><span class="math inline">\(\frac{1}{n} \sum_{i=1}^{n} \|y_i - \hat{y}_i\|\)</span></td>
<td>Used in regression tasks, e.g., predicting survival time; less sensitive to outliers than MSE</td>
</tr>
<tr class="even">
<td>8a. Mean Squared Error (MSE)</td>
<td>Average of squared differences between predicted and actual values</td>
<td><span class="math inline">\(\frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i)^2\)</span></td>
<td>Used in regression; penalizes large errors more, suitable when large errors are particularly undesirable</td>
</tr>
<tr class="odd">
<td>8b. Root Mean Squared Error (RMSE)</td>
<td>Square root of MSE</td>
<td><span class="math inline">\(\sqrt{\text{MSE}}\)</span></td>
<td>Same as MSE, but in the original unit of the target variable, making it more interpretable</td>
</tr>
<tr class="even">
<td>9. R-squared</td>
<td>Proportion of variance in dependent variable predictable from independent variables</td>
<td><span class="math inline">\(1 - \frac{\sum_{i=1}^{n} (y_i - \hat{y}_i)^2}{\sum_{i=1}^{n} (y_i - \bar{y})^2}\)</span></td>
<td>Used in regression to assess overall fit; indicates how well the model explains the variance in the data</td>
</tr>
<tr class="odd">
<td>10a. Akaike Information Criterion (AIC)</td>
<td>Measures relative quality of statistical model for given data</td>
<td><span class="math inline">\(2k - 2\ln(L)\)</span> where <span class="math inline">\(k\)</span> is number of parameters and <span class="math inline">\(L\)</span> is likelihood</td>
<td>Used for model selection; helps prevent overfitting by penalizing complex models</td>
</tr>
<tr class="even">
<td>10b. Bayesian Information Criterion (BIC)</td>
<td>Similar to AIC but with stronger penalty term for number of parameters</td>
<td><span class="math inline">\(k\ln(n) - 2\ln(L)\)</span> where <span class="math inline">\(n\)</span> is number of observations</td>
<td>Also used for model selection; tends to favor simpler models compared to AIC</td>
</tr>
</tbody>
</table>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/wu-msds-capstones\.github\.io\/Air-Quality-Index\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>